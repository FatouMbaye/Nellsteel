(window.webpackJsonp=window.webpackJsonp||[]).push([["pivot-hover"],{"/qgZ":function(e,t,o){"use strict";o.r(t),o.d(t,"PivotHover",(function(){return K})),o.d(t,"PivotHoverActions",(function(){return y})),o.d(t,"PivotHoverConnector",(function(){return E})),o.d(t,"PivotHoverReducer",(function(){return _})),o.d(t,"ToolingInfo",(function(){return J}));var i=o("+viU"),s=o("5mwN"),r=o("wirn"),n=o("YJhp"),a=o("Am8i"),c=o("6nIz"),l=o("vWld"),d=o("6PtM"),h=o("ERkP"),u=o.n(h),v=o("7nmT"),p=o.n(v),m=o("mObi");class g extends s.a{constructor(){super(...arguments),this.handledProps=Object.assign(Object.assign({},s.b),{managedClasses:void 0,articleAriaHelpText:void 0,hoverFlyoutOpen:void 0,headerText:void 0,articles:void 0,onClosed:void 0,onComponentCreated:void 0,requestOpen:void 0,targetPivotRect:void 0,telemetryObject:void 0,requestContext:void 0}),this.getArticleTelemetryTags=Object(m.a)(e=>this.props.telemetryObject?(this.articleTelemetryObject=this.props.telemetryObject&&this.props.telemetryObject.addOrUpdateChild({name:"HoverFlyoutArticle",content:{id:e},type:a.e.Headline},this.articleTelemetryObject),this.articleTelemetryObject?this.articleTelemetryObject.render():null):{}),this.onClosed=e=>{this.props.onClosed(e),this.lastFocusedPivot&&e&&this.lastFocusedPivot.focus()},this.onListBlur=()=>{this.lastFocusedPivot&&this.lastFocusedPivot.focus()}}render(){if(super.render(),!this.props.hoverFlyoutOpen)return null;this.itemRefs=[];let e=0;return u.a.createElement(c.a,Object.assign({className:this.generateClassNames(this.props.managedClasses.pivotHover_root),targetRect:this.props.targetPivotRect,flyoutWidth:300,requestOpen:this.props.requestOpen,onClosed:this.onClosed,id:"pivotHoverFlyout",requestContext:this.props.requestContext},this.unhandledProps()),this.renderHeaderIfNeeded(),u.a.createElement(d.a,{blurHandler:this.onListBlur},this.props.articles.map(t=>{e++;const o=u.a.createRef();return this.itemRefs.push(o),u.a.createElement(l.a,{key:e,title:t.title,url:t.url,providerName:t.providerName,imageBaseUrl:t.imageUrl,imageFocalRegion:t.imageFocalRegion,ref:o,ariaHelpText:this.props.articleAriaHelpText,telemetryTags:this.getArticleTelemetryTags(t.id),requestContext:this.props.requestContext})})))}componentDidMount(){this.props.onComponentCreated(this)}componentDidUpdate(e){!e.hoverFlyoutOpen&&this.props.hoverFlyoutOpen&&(this.lastFocusedPivot=document.activeElement)}focusListItem(e){this.lastFocusedPivot=document.activeElement;const t=e?this.itemRefs[0]:this.itemRefs[this.itemRefs.length-1];p.a.findDOMNode(t.current).focus()}renderHeaderIfNeeded(){if(this.props.headerText){const{managedClasses:e}=this.props;return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:e.pivotHover_header},u.a.createElement(r.a,{className:e.pivotHover_trendingIcon,glyphType:n.b.Trending,width:"16px",height:"16px"}),u.a.createElement("span",{className:e.pivotHover_headerText},this.props.headerText)),u.a.createElement("hr",{className:e.pivotHover_separator}))}return null}}g.defaultProps={experienceName:"PivotHover"};var f=o("G82u");class y{}y.openHoverFlyout=new f.a("OpenHoverFlyout"),y.closeHoverFlyout=new f.a("CloseHoverFlyout"),y.updateMouseHover=new f.a("UpdateMouseHover"),y.updatePivotFocus=new f.a("UpdatePivotFocus");var F,b=o("CuO/"),H=o("D57K");!function(e){e.JustFeedTitle="JustFeedTitle",e.LatestIn="LatestIn"}(F||(F={}));var C=o("w0HK"),x=o("ICfc"),O=o("HxRh"),T=o("u5KZ"),w=o("rvYQ");const P="{value{subCards{id title url images{url focalRegion{x1 y1 x2 y2}} provider{name}}}}";function S(e,t,o){return Object(H.b)(this,void 0,void 0,(function*(){const i={},s=[],r=w.b.CurrentMarket;s.push(`{myFeed: newsFeedV0(top:${t}, market:"${r}")${P}`);for(const o of e){const e=o.replace(/-/g,"");s.push(`${e}: newsFeedV0(ids:"${o}", top:${t}, market:"${r}")${P}`)}s.push("}");try{const e=yield function(e,t){return Object(H.b)(this,void 0,void 0,(function*(){return(yield fetch(`https://api.msn.com/graphql/graphql?apikey=${w.b.OneServiceApiKey}&ocid=${t}&scn=${w.b.AuthCookieName}&activityId=${w.b.ActivityId}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:e}),credentials:"include"})).json()}))}(s.join(""),o);if(!e||!e.data)return N("Feed summary response was empty."),i;for(const t of Object.keys(e.data)){const o=e.data[t];if(!o||!o.value)continue;const s=o.value;if(!s.length||!s[0].subCards)continue;const r=s[0].subCards;if(!r||!r.length)continue;const a=[];for(const e of r){const t=e.images&&e.images.length>0,o={id:e.id,title:e.title,url:e.url,providerName:e.provider.name,imageUrl:t?e.images[0].url:void 0,imageFocalRegion:t?e.images[0].focalRegion:void 0};a.push(o)}if(a.length>0){i["myFeed"===t?t:`${(n=t).substring(0,10)}-${n.substring(10,14)}-${n.substring(14,18)}-${n.substring(18,22)}-${n.substring(22)}`]=a}}}catch(e){N(e)}var n;return i}))}function N(e){T.a.sendAppErrorEvent(Object.assign(Object.assign({},O.Yd.FeedSummaryFetchError),{message:e}))}var I=o("iCAe"),j=o("6fq4");const A={inspect:e=>{const{config:t,state:o,connectorArgs:i}=e,{localizedStrings:s}=t;let r;o.feedName&&(r=t.flyoutHeaderFormat===F.LatestIn?s.headerLatestInFormat.replace("{0}",o.feedName):o.feedName);return{props:{articleAriaHelpText:s.articleAriaHelpText,hoverFlyoutOpen:o.hoverFlyoutOpen,headerText:r,articles:o.articles,requestOpen:o.isMouseOverPivot||o.pivotHasFocus,targetPivotRect:o.targetPivotRect,requestContext:i.requestContext},missingChildren:[]}}};var D,k=o("WfnD"),R=o("s9+9"),L=o("9J8d"),M=o("DCIk");!function(e){e[e.NoHover=0]="NoHover",e[e.HoveredWaiting=1]="HoveredWaiting",e[e.FetchingDataForFlyout=2]="FetchingDataForFlyout",e[e.FlyoutOpen=3]="FlyoutOpen"}(D||(D={}));class E extends k.a{constructor(){super(...arguments),this.hoverState=D.NoHover,this.startHover=e=>{if(this.supportsFlyout(e)&&!Object(I.b)()){switch(this.hoveredPivot=e,this.hoverState){case D.NoHover:this.hoverState=D.HoveredWaiting,this.startHoverDwellTimer();break;case D.HoveredWaiting:clearTimeout(this.hoverDwellTimer),this.startHoverDwellTimer();break;case D.FetchingDataForFlyout:break;case D.FlyoutOpen:this.swapFlyoutToHoveredPivot()}y.updateMouseHover.getActionSender(this).send(!0)}},this.endHover=()=>{switch(this.hoverState){case D.HoveredWaiting:clearTimeout(this.hoverDwellTimer),this.moveToNoHoverState();break;case D.FetchingDataForFlyout:this.moveToNoHoverState();break;case D.NoHover:case D.FlyoutOpen:}y.updateMouseHover.getActionSender(this).send(!1)},this.onFocus=e=>{if(this.pivotFocused=!0,this.supportsFlyout(e)&&!this.getCurrentState().forceClosed&&j.a){switch(this.hoveredPivot=e,this.hoverState){case D.NoHover:this.startLoadingHoverData();break;case D.HoveredWaiting:clearTimeout(this.hoverDwellTimer),this.startLoadingHoverData();break;case D.FetchingDataForFlyout:break;case D.FlyoutOpen:this.swapFlyoutToHoveredPivot()}y.updatePivotFocus.getActionSender(this).send(!0)}},this.onBlur=()=>{this.pivotFocused=!1,y.updatePivotFocus.getActionSender(this).send(!1)},this.onClick=()=>{this.moveToNoHoverState(),y.closeHoverFlyout.getActionSender(this).send(!0)},this.onMoveToPreview=e=>this.hoverState===D.FlyoutOpen&&(this.boundComponent.focusListItem(e),!0),this.startLoadingHoverData=()=>Object(H.b)(this,void 0,void 0,(function*(){this.hoverState=D.FetchingDataForFlyout;let e=this.getArticleListForHoveredPivot();if(e)return void this.showFlyoutForHoveredPivot(e);const t=this.getTopicDataConnector();if(!t)return void this.moveToNoHoverState();let o=yield t.getFollowedTopics();o=o.slice(0,this.config.xFeedCount||15),this.feedSummaryPromise&&Object(M.a)(o,this.topicIdsForFeedSummaryFetch)||(this.topicIdsForFeedSummaryFetch=o,this.feedSummaryPromise=S(o,3,this.config.ocid)),this.cachedFeedSummaries=yield this.feedSummaryPromise,this.feedSummaryPromise=null,this.topicIdsForFeedSummaryFetch=null,this.noLongerHovering()||(e=this.getArticleListForHoveredPivot(),e&&e.length?this.showFlyoutForHoveredPivot(e):this.moveToNoHoverState())})),this.onFlyoutClosed=e=>{y.closeHoverFlyout.getActionSender(this).send(e),this.moveToNoHoverState(),Object(I.d)(I.a.pivot,!1)},this.onComponentCreated=e=>{this.boundComponent=e}}mapStateToProps(e){const t={requestContext:this.requestContext},o={config:this.config,children:this.childComponentInstanceList,state:e,connectorArgs:t},i=A.inspect(o),s=Object.assign(Object.assign(Object.assign({},i.props),this.telemetryTags),{telemetryObject:this.telemetryObject});return s.onClosed=this.onFlyoutClosed,s.onComponentCreated=this.onComponentCreated,s}onComponentConnect(e){return Object(H.b)(this,void 0,void 0,(function*(){yield k.a.prototype.onComponentConnect.call(this,e);const t=L.a.getInstance().rootReducer.connector(R.a.SharedState);if(t&&t.getCurrentState().useHistory)return;const o=Object(C.a)();o.addStartHoverListener(this.startHover),o.addEndHoverListener(this.endHover),o.addFocusListener(this.onFocus),o.addBlurListener(this.onBlur),o.setMoveToPreviewListener(this.onMoveToPreview),o.addClickListener(this.onClick)}))}supportsFlyout(e){return!e.isOverflow&&(e.dynamicPivotSource===x.a.TopicsData||!e.dynamicPivotSource&&e.pivotId===this.config.myFeedPivotId)}startHoverDwellTimer(){this.hoverDwellTimer=setTimeout(this.startLoadingHoverData,100)}swapFlyoutToHoveredPivot(){const e=this.getArticleListForHoveredPivot();e?this.showFlyoutForHoveredPivot(e):(this.cachedFeedSummaries=null,this.hoverState=D.FetchingDataForFlyout,this.startLoadingHoverData())}showFlyoutForHoveredPivot(e){this.hoverState=D.FlyoutOpen,T.a.sendActionEvent(this.hoveredPivot.element,a.a.Hover,a.b.Show);const t=this.hoveredPivot.dynamicPivotSource===x.a.TopicsData||this.hoveredPivot&&"oneriver.myfeed"===this.hoveredPivot.pivotId?this.hoveredPivot.display:null;y.openHoverFlyout.getActionSender(this).send(this.hoveredPivot.element.getBoundingClientRect(),t,e),this.pivotFocused&&!this.getCurrentState().forceClosed&&Object(I.d)(I.a.pivot,!0)}getArticleListForHoveredPivot(){return this.cachedFeedSummaries&&this.hoveredPivot?this.hoveredPivot.pivotId===this.config.myFeedPivotId?this.cachedFeedSummaries.myFeed:this.hoveredPivot.context?this.cachedFeedSummaries[this.hoveredPivot.context.feedId]:null:null}noLongerHovering(){return this.hoverState===D.NoHover}moveToNoHoverState(){this.hoverState=D.NoHover,this.hoveredPivot=null}getTopicDataConnector(){return L.a.getInstance().rootReducer.connector(R.a.TopicData)}}var q=o("05Au");class _{reduce(e,t){if(!e)return{hoverFlyoutOpen:!1,articles:[],forceClosed:!1,isMouseOverPivot:!1,pivotHasFocus:!1};if(!t)return e;let o;return q.a.handleAction(t,y.openHoverFlyout,(t,i,s)=>{o=Object.assign(Object.assign({},e),{hoverFlyoutOpen:!0,feedName:i,articles:s,targetPivotRect:t})}),q.a.handleAction(t,y.closeHoverFlyout,t=>{o=Object.assign(Object.assign({},e),{hoverFlyoutOpen:!1,forceClosed:t})}),q.a.handleAction(t,y.updateMouseHover,t=>{o=Object.assign(Object.assign({},e),{isMouseOverPivot:t})}),q.a.handleAction(t,y.updatePivotFocus,t=>{o=Object.assign(Object.assign({},e),{pivotHasFocus:t}),t||(o.forceClosed=!1)}),o||e}}var U=o("XI4f"),W=o("rRWH");const B={pivotHover_root:{},pivotHover_header:{display:"flex",margin:"12px 16px"},pivotHover_trendingIcon:{fill:U.a},pivotHover_headerText:{color:U.a,"font-size":"12px","font-weight":"600","margin-left":Object(W.c)("8px","auto"),"margin-right":Object(W.c)("auto","8px")},pivotHover_separator:{background:U.a,border:"none",height:"1px",margin:"0 16px"}};var $=o("jiKz"),z=o("O8lJ");const K=Object(i.a)(B)(g),J={reactComponent:K,experienceConfigSchema:b.PivotHoverConfigSchema,mockState:z.mockState,mockConfig:$.mockConfig,inspector:A.inspect}},"6PtM":function(e,t,o){"use strict";o.d(t,"a",(function(){return l}));var i=o("+viU"),s=o("Gy7L"),r=o("OnwC"),n=o("ERkP"),a=o.n(n);class c extends r.a{constructor(e){super(e),this.handledProps={managedClasses:void 0,blurHandler:void 0},this.onKeyDown=e=>{switch(e.keyCode){case s.e:this.focusPreviousItem(),e.preventDefault();break;case s.b:this.focusNextItem(),e.preventDefault();break;case s.m:e.shiftKey?this.focusPreviousItem():this.focusNextItem(),e.preventDefault()}}}render(){const{managedClasses:e}=this.props;return a.a.createElement("div",{onKeyDown:this.onKeyDown},this.props.children)}focusNextItem(){let e=document.activeElement.nextSibling;for(;e&&-1!==e.tabIndex;)e=e.nextSibling;e?e.focus():this.props.blurHandler()}focusPreviousItem(){let e=document.activeElement.previousSibling;for(;e&&-1!==e.tabIndex;)e=e.previousSibling;e?e.focus():this.props.blurHandler()}}const l=Object(i.a)({HoverFlyoutList_root:{}})(c)},"6fq4":function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));var i=o("HDSB");let s=!1;Object(i.a)()&&(window.addEventListener("keydown",()=>{s=!0}),window.addEventListener("mousedown",()=>{s=!1}))},"6nIz":function(e,t,o){"use strict";o.d(t,"a",(function(){return m}));var i=o("+viU"),s=o("OnwC"),r=o("6fq4"),n=o("1I/+"),a=o("ERkP"),c=o.n(a),l=o("Gy7L");class d extends s.a{constructor(e){super(e),this.handledProps={managedClasses:void 0,targetRect:void 0,requestOpen:void 0,onClosed:void 0,flyoutWidth:void 0,requestContext:void 0},this.onResize=()=>{this.props.onClosed(!0)},this.onScroll=()=>{this.props.onClosed(!0)},this.onKeyDown=e=>{e.keyCode===l.h&&this.props.onClosed(!0)},this.onMouseEnter=()=>{this.mouseOverFlyout=!0,this.cancelCloseIfNeeded(),this.cancelStrayMouseTimerIfNeeded()},this.onMouseLeave=()=>{this.mouseOverFlyout=!1,this.startStrayMouseTimerIfNeeded()},this.onFocus=()=>{r.a&&(this.focusInFlyout=!0,this.cancelCloseIfNeeded(),this.cancelStrayMouseTimerIfNeeded())},this.onBlur=()=>{this.focusInFlyout=!1,this.startStrayMouseTimerIfNeeded()},this.state={visible:!1}}componentDidMount(){window.addEventListener("resize",this.onResize),window.addEventListener("scroll",this.onScroll),setTimeout(()=>{this.setState({visible:!0})},0)}render(){const e=this.props.targetRect,t=e.top+e.bottom<window.innerHeight,o=Object(n.b)(this.props.requestContext.data.innerWidth,"innerWidth");let i=Math.round((e.left+e.right-this.props.flyoutWidth)/2);i<16?i=16:i>o-16-this.props.flyoutWidth&&(i=o-16-this.props.flyoutWidth);const s={left:i+"px",width:this.props.flyoutWidth+"px",opacity:this.state.visible?1:0};if(t){const t=e.bottom+0;s.top=t+"px",s.maxHeight=window.innerHeight-t-16+"px"}else{const t=window.innerHeight-e.top+0;s.bottom=t+"px",s.maxHeight=e.top-0-16+"px"}return c.a.createElement("div",Object.assign({},this.unhandledProps(),{className:this.generateClassNames(this.props.managedClasses.HoverFlyout_root),style:s,onKeyDown:this.onKeyDown,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onFocus:this.onFocus,onBlur:this.onBlur}),this.props.children)}componentDidUpdate(e){e.requestOpen!==this.props.requestOpen&&(this.props.requestOpen?(this.cancelCloseIfNeeded(),this.cancelStrayMouseTimerIfNeeded()):this.startStrayMouseTimerIfNeeded())}componentWillUnmount(){window.removeEventListener("resize",this.onResize),window.removeEventListener("scroll",this.onScroll),this.cancelStrayMouseTimerIfNeeded(),this.cancelCloseIfNeeded()}startStrayMouseTimerIfNeeded(){this.mouseOverFlyout||this.props.requestOpen||this.focusInFlyout||(this.strayMouseTimerHandle=setTimeout(()=>{this.startClosing(),this.strayMouseTimerHandle=null},200))}cancelStrayMouseTimerIfNeeded(){this.strayMouseTimerHandle&&clearTimeout(this.strayMouseTimerHandle)}cancelCloseIfNeeded(){this.closeAnimationTimerHandle&&clearTimeout(this.closeAnimationTimerHandle),this.state.visible||this.setState({visible:!0})}startClosing(){this.closeAnimationTimerHandle=setTimeout(()=>{this.props.onClosed(!1)},200),this.setState({visible:!1})}}var h=o("MZhw"),u=o("objN"),v=o("0fst");const p={HoverFlyout_root:Object.assign({background:h.c,"box-shadow":"2px 5px 20px 0px rgba(0,0,0,0.22), 0px 13px 13px rgba(0,0,0,0.18)","border-radius":"4px",overflow:"auto",position:"fixed",transition:"opacity 0.2s ease-in","z-index":v.a.Flyout.toString()},u.d)},m=Object(i.a)(p)(d)},"CuO/":function(e,t){},ICfc:function(e,t,o){"use strict";var i;o.d(t,"a",(function(){return i})),function(e){e.NavigationData="NavigationDataAdapter",e.TopicsData="TopicsDataAdapter",e.LayoutPreferenceData="LayoutPreferenceDataAdapter"}(i||(i={}))},O8lJ:function(e,t){},jiKz:function(e,t){},vWld:function(e,t,o){"use strict";o.d(t,"a",(function(){return y}));var i=o("+viU"),s=o("1I/+"),r=o("Fpjf"),n=o("FPTP"),a=o("y2Il"),c=o("OnwC"),l=o("ERkP"),d=o.n(l);class h extends c.a{constructor(e){super(e),this.handledProps={managedClasses:void 0,ariaHelpText:void 0,imageBaseUrl:void 0,imageFocalRegion:void 0,providerName:void 0,requestContext:void 0,telemetryTags:void 0,title:void 0,url:void 0},this.imageRef=d.a.createRef()}render(){const{managedClasses:e,telemetryTags:t}=this.props;return d.a.createElement("a",Object.assign({href:this.props.url,target:"_blank",rel:"noopener",className:this.generateClassNames(e.HoverFlyoutArticle_root),"aria-label":this.props.title+". "+this.props.ariaHelpText,tabIndex:-1},t),d.a.createElement("div",{className:e.HoverFlyoutArticle_mainContent},d.a.createElement(n.a,{tag:a.b.span,className:e.HoverFlyoutArticle_titleText,size:a.a._7},this.props.title),d.a.createElement("div",{className:e.HoverFlyoutArticle_providerText},this.props.providerName)),this.renderImage())}componentDidUpdate(e){if(e.imageBaseUrl!==this.props.imageBaseUrl&&this.props.imageBaseUrl){const e=this.imageRef.current.src;this.imageRef.current.src="",this.imageRef.current.src=e}}renderImage(){if(!this.props.imageBaseUrl)return null;const e=Object(s.b)(this.props.requestContext.data.devicePixelRatio,"devicePixelRatio"),t=Object(r.e)(this.props.imageBaseUrl,{width:48,height:48,focalRegion:this.props.imageFocalRegion,enableDpiScaling:!0,devicePixelRatio:e});return d.a.createElement("div",{className:this.props.managedClasses.HoverFlyoutArticle_imageHolder},d.a.createElement("img",{src:t,className:this.props.managedClasses.HoverFlyoutArticle_image,ref:this.imageRef}))}}var u=o("LD6M"),v=o("7b0X"),p=o("SP+O"),m=o("XI4f"),g=o("rRWH");const f={HoverFlyoutArticle_root:{display:"flex",height:"92px",padding:"2px","text-decoration":"none","&:hover":{background:u.b},"&:active":{background:u.a},"&:focus":{outline:"none","border-color":v.a,"border-style":"solid","border-width":"2px",padding:"0"}},HoverFlyoutArticle_mainContent:{"flex-grow":"1",margin:"14px"},HoverFlyoutArticle_titleText:{color:p.c,overflow:"hidden","text-overflow":"ellipsis",display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical","font-weight":"600"},HoverFlyoutArticle_providerText:{color:m.a,"font-size":"12px","padding-top":"4px",overflow:"hidden","text-overflow":"ellipsis",display:"-webkit-box","-webkit-line-clamp":"1","-webkit-box-orient":"vertical"},HoverFlyoutArticle_imageHolder:{width:"48px",height:"48px","margin-right":Object(g.c)("14px","0"),"margin-left":Object(g.c)("0","14px"),"margin-top":"14px"},HoverFlyoutArticle_image:{"border-radius":"2px",width:"48px",height:"48px"}},y=Object(i.a)(f)(h)}}]);